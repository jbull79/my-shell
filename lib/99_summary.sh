#!/usr/bin/env bash
# shellcheck shell=bash
set -euo pipefail
[[ "${BASH_SOURCE[0]}" == "$0" ]] && {
  echo "Source via install.sh"
  exit 1
}

echo "ğŸ“¦ Backup directory: ${BACKUP_DIR:-$HOME/.setup_backups/backup_$(date +%Y%m%d_%H%M%S)}"
echo "âœ… Setup complete!"
echo "ğŸ’¡ Font: MesloLGS NF (set in terminal preferences)"
echo ""
echo "You can verify glyph support with:"
echo "  echo 'îœ‚ î‚¶ î‚´ î‚° î‚± î‚² î‚³ î‚¼ î‚º î‚¾'"
echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "âœ… SETUP SUMMARY"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "ğŸ“¦ Backups:          ${BACKUP_DIR:-$HOME/.setup_backups}"
echo "ğŸ” SSH Key:          ${SSH_DIR:-$HOME/.ssh}/id_ed25519"
echo "ğŸ”‘ GPG Key:          ${GPG_DIR:-$HOME/.gnupg}"
echo "ğŸ§± Git Config:       ${GITCONFIG:-$HOME/.gitconfig}"
echo "ğŸ’¡ Font:             MesloLGS NF"
echo "ğŸš€ Starship auto-switch: Enabled (Git/Non-Git)"
echo "ğŸ§© Bat Theme:        ${BAT_DEFAULT_THEME:-TwoDark}"
echo ""
echo "â˜ï¸ AWS CLI SETUP"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "ğŸ“ Config Directory: ${AWS_CONFIG_DIR:-$HOME/.aws}"
echo "ğŸ§¾ Config File:      ${AWS_CONFIG_DIR:-$HOME/.aws}/config"
echo "ğŸ”‘ Credentials File: ${AWS_CONFIG_DIR:-$HOME/.aws}/credentials"

if [[ -f "${AWS_CONFIG_DIR:-$HOME/.aws}/config" ]]; then
  PROFILES=$(grep -E '^\[profile ' "${AWS_CONFIG_DIR:-$HOME/.aws}/config" | sed -E 's/^\[profile (.*)\]/\1/' | xargs || true)
  [[ -z "$PROFILES" ]] && PROFILES="dev prod"
else
  PROFILES="dev prod"
fi
echo "ğŸ§© Profiles Created: ${PROFILES}"
echo "ğŸŒ Default Output:   json"
echo ""
echo "To update credentials later:"
echo "  aws configure --profile <profile>"
echo ""
echo "Manual edit locations:"
echo "  - ${AWS_CONFIG_DIR:-$HOME/.aws}/config"
echo "  - ${AWS_CONFIG_DIR:-$HOME/.aws}/credentials"
echo ""
echo "ğŸ” Profile Switching: Enabled"
echo "   â†’ Use 'aws-switch' to choose a profile (fzf picker)"
echo "   â†’ Use 'aws-whoami' to verify active credentials"
echo ""
echo "[INFO] Setup complete. Please reload your shell manually to apply all changes:"
echo "   source ~/.zshrc"
echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "ğŸ’¡  IMPORTANT: Set your terminal font manually!"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
echo "Starship uses Nerd Font icons. To display them correctly:"
echo ""
echo "  1ï¸âƒ£  Open your terminal preferences"
echo "  2ï¸âƒ£  Change the font to:  MesloLGS NF"
echo "  3ï¸âƒ£  Restart your terminal session"
echo ""
echo "You can verify glyph support with this command:"
echo "  echo 'îœ‚ î‚¶ î‚´ î‚° î‚± î‚² î‚³ î‚¼ î‚º î‚¾'"
echo ""
echo "If icons appear correctly, your setup is complete âœ…"
